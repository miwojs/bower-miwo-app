!function(){var __hasProp={}.hasOwnProperty,__extends=function(t,e){function o(){this.constructor=t}for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};!function t(e,o,n){function r(s,a){if(!o[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=o[s]={exports:{}};e[s][0].call(u.exports,function(t){var o=e[s][1][t];return r(o?o:t)},u,u.exports,t,e,o,n)}return o[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e){var o,n;n=t("./EventManager"),o=function(t){function e(t){this.controllers={},this.eventMgr=new n,e.__super__.constructor.call(this,t)}return __extends(e,t),e.inject("injector"),e.inject("controllerFactory","miwo.controllerFactory"),e.prototype.eventMgr=null,e.prototype.componentMgr=null,e.prototype.viewport=null,e.prototype.rendered=!1,e.prototype.controllers=null,e.prototype.runControllers=null,e.prototype.autoCanonicalize=!0,e.prototype.setInjector=function(t){if(this.injector=t,!t.has("viewport"))throw new Error("Missing 'viewport' service. Viewport is required to render your application")},e.prototype.run=function(t){var e,o,n,r;for(null==t&&(t=null),r=this.runControllers,o=0,n=r.length;n>o;o++)e=r[o],this.getController(e,function(e){return function(o){e.runControllers.erase(o.name),0===e.runControllers.length&&t&&e.render(t)}}(this))},e.prototype.render=function(t){var e,o,n,r,i;if(null==t&&(t=null),!this.rendered){this.rendered=!0,n=this.getViewport(),r=this.controllers;for(o in r)e=r[o],e.beforeRender();n.render(t||miwo.body),i=this.controllers;for(o in i)e=i[o],e.afterRender();window.onhashchange=this.executeRequestByHash.bind(this),this.executeRequestByHash()}},e.prototype.getController=function(t,e){var o;o=this.controllers[t],o?o.onStartup(e):(o=this.controllers[t]=this.controllerFactory.create(t),o.application=this,o.onStartup(e),o.initialize())},e.prototype.control=function(t,e){Type.isString(t)?this.eventMgr.control(t,e):t.on(e)},e.prototype.getViewport=function(){return this.injector.get("viewport")},e.prototype.getRouter=function(){return this.injector.get("miwo.router")},e.prototype.execute=function(t){this.getController(t.controller,function(){return function(e){e.execute(t)}}(this))},e.prototype.forward=function(t){miwo.async(function(e){return function(){return e.execute(t)}}(this))},e.prototype.redirect=function(t,e){Type.isString(t)&&"#"===t.charAt(0)&&(t=this.getRouter().constructRequest(t.replace(/^#/,""))),this.request?this.getController(this.request.controller,function(o){return function(n){n.terminate(o.request,function(){o.redirectRequest(t,e)})}}(this)):this.redirectRequest(t,e)},e.prototype.redirectRequest=function(t,e){var o;e&&(t.params._rid=Math.random().toString(36).substring(4,10)),o=this.getRouter().constructHash(t),document.location.hash=o},e.prototype.executeRequestByHash=function(){var t,e,o;return e=document.location.hash.substr(1),e||this.autoCanonicalize?(o=this.getRouter().constructRequest(e),t=this.getRouter().constructHash(o),this.autoCanonicalize&&t!==e?void(document.location.hash=t):void this.execute(o)):void 0},e}(Miwo.Object),e.exports=o},{"./EventManager":6}],2:[function(t,e){var o;o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.componentCls="miwo-views",e.prototype.role="main",e.prototype.addedComponent=function(t){e.__super__.addedComponent.call(this,t),t.el.addClass("miwo-views-item")},e.prototype.doRender=function(){e.__super__.doRender.apply(this,arguments),this.el.setStyle("overflow","auto")},e}(Miwo.Container),e.exports=o},{}],3:[function(t,e){var o,n=[].slice;o=function(t){function e(t){e.__super__.constructor.call(this,t),this.startuped=!1,this.onStartupCallbacks=[],this.views={}}return __extends(e,t),e.prototype.name=null,e.prototype.injector=null,e.prototype.application=null,e.prototype.request=null,e.prototype.views=null,e.prototype.view=null,e.prototype.request=null,e.prototype.lastRequest=null,e.service=function(t,e){null==e&&(e=null),Object.defineProperty(this.prototype,t,{get:function(){return this.injector.get(e||t)}})},e.registerView=function(t,e){this.prototype["create"+t.capitalize()+"View"]=function(t){return new e(t)}},e.prototype.initialize=function(){this.startup(function(t){return function(){miwo.async(function(){var e,o,n,r;for(t.startuped=!0,r=t.onStartupCallbacks,o=0,n=r.length;n>o;o++)(e=r[o])(t);t.onStartupCallbacks.empty()})}}(this))},e.prototype.onStartup=function(t){this.startuped?miwo.async(function(e){return function(){return t(e)}}(this)):this.onStartupCallbacks.push(t)},e.prototype.startup=function(t){t()},e.prototype.beforeRender=function(){},e.prototype.afterRender=function(){},e.prototype.control=function(t,e){this.application.control(t,this.boundEvents(e))},e.prototype.getViewport=function(){return this.application.getViewport()},e.prototype.setInjector=function(t){this.injector=t},e.prototype.boundEvents=function(t){var e,o;for(o in t)e=t[o],t[o]=this.boundEvent(e);return t},e.prototype.boundEvent=function(t){return function(e){return function(){var o;return o=1<=arguments.length?n.call(arguments,0):[],Type.isString(t)?e[t].apply(e,o):t.apply(e,o)}}(this)},e.prototype.refresh=function(t){var e,o;this.hasView(t)&&(o=this.getView(t),e=this.formatMethodName(o.request.action,"render"),this[e]&&this[e](o.request,o))},e.prototype.forward=function(t,e){this.application.forward(this.createRequest(t,e))},e.prototype.redirect=function(t,e,o){this.application.redirect(this.createRequest(t,e),o)},e.prototype.createRequest=function(t,e){return this.injector.get("miwo.requestFactory").create(t,e,{name:this.name,action:this.action})},e.prototype.execute=function(t){var e;return e=this.formatMethodName(t.action,"show"),this[e]?void this[e](t,function(e){return function(o){e.executeDone(t,o)}}(this)):void this.executeDone(t)},e.prototype.executeDone=function(t,e){var o;t.executed||(t.executed=!0,e||(e=t.action),t.view=e,o=this.getView(e||t.action),o.request=t,this.application.request=t,this.getViewport().activateView(o.viewName,function(n){return function(){var r;r=n.formatMethodName(e,"render"),n[r]&&n[r](t,o)}}(this)))},e.prototype.terminate=function(t,e){var o;return o=this.formatMethodName(t.view,"hide"),this[o]?void this[o](t,this.getView(t.view),function(){return function(){miwo.async(function(){return e()})}}(this)):void miwo.async(function(){return function(){return e()}}(this))},e.prototype.getView=function(t){var e,o;return o=this.getViewport(),e=this.formatViewName(t),o.hasView(e)||o.addView(e,this.createView(t)),o.getView(e)},e.prototype.hasView=function(t){var e,o;return o=this.getViewport(),e=this.formatViewName(t),o.hasView(e)},e.prototype.createView=function(t){var e,o;if(e="create"+t.capitalize()+"View",!this[e])throw new Error("View "+t+" has no factory method. You must define "+e+" method in controller "+this);if(o=this[e]({isView:!0,visible:!1,viewName:this.formatViewName(t),id:this.name+t.capitalize()+"View"}),!(o instanceof Miwo.Component))throw new Error("Created view should by instance of Miwo.Component");return o},e.prototype.formatMethodName=function(t,e){return e+t.capitalize()},e.prototype.formatViewName=function(t){return this.name+"."+t},e}(Miwo.Object),e.exports=o},{}],4:[function(require,module,exports){var Controller,ControllerFactory;Controller=require("./Controller"),ControllerFactory=function(_super){function ControllerFactory(t){ControllerFactory.__super__.constructor.call(this,t),this.controllers={}}return __extends(ControllerFactory,_super),ControllerFactory.prototype.injector=ControllerFactory.inject("injector"),ControllerFactory.prototype.namespace="App",ControllerFactory.prototype.controllers=null,ControllerFactory.prototype.register=function(t,e){return this.controllers[t]=e,this},ControllerFactory.prototype.create=function(name){var controller,e,klass,klassName;klassName=this.formatClassName(name);try{klass=eval(klassName)}catch(_error){throw e=_error,new Error("Controller class "+klassName+" is bad defined")}if("function"!=typeof klass)throw new Error("Controller class "+klassName+" is not constructor");if(controller=this.injector.createInstance(klass),controller.setInjector(this.injector),controller.name=name,!(controller instanceof Controller))throw new Error("Controller "+klassName+" is not instance of Controller");return controller},ControllerFactory.prototype.formatClassName=function(t){return this.controllers[t]?this.controllers[t]:this.namespace+".controllers."+t.capitalize()+"Controller"},ControllerFactory}(Miwo.Object),module.exports=ControllerFactory},{"./Controller":3}],5:[function(t,e){var o,n,r,i,s,a;o=t("./Application"),a=t("./Router"),s=t("./RequestFactory"),r=t("./FlashNotificator"),n=t("./ControllerFactory"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.init=function(){this.setConfig({flash:null,controllers:{},run:[],defaultController:"default",defaultAction:"default",autoCanonicalize:!0})},e.prototype.build=function(t){t.define("application",o,function(t){return function(e){return e.runControllers=t.config.run,e.autoCanonicalize=t.config.autoCanonicalize}}(this)),t.define("flash",r,function(t){return function(e){return e.renderer=t.config.flash}}(this)),t.define("miwo.controllerFactory",n,function(t){return function(e){var o,n,r;e.namespace=t.config.namespace,r=t.config.controllers;for(n in r)o=r[n],e.register(n,o)}}(this)),t.define("miwo.router",a,function(t){return function(e){e.controller=t.config.defaultController,e.action=t.config.defaultAction}}(this)),t.define("miwo.requestFactory",s)},e}(Miwo.di.InjectorExtension),e.exports=i},{"./Application":1,"./ControllerFactory":4,"./FlashNotificator":7,"./RequestFactory":9,"./Router":10}],6:[function(t,e){var o;o=function(t){function e(){e.__super__.constructor.call(this),this.selectors=[],miwo.componentMgr.on("register",this.bound("onRegister")),miwo.componentMgr.on("unregister",this.bound("onUnregister"))}return __extends(e,t),e.prototype.selectors=null,e.prototype.control=function(t,e){this.selectors.push({selector:t,events:e,parts:t.split(" ")})},e.prototype.onRegister=function(t){var e,o,n,r,i,s,a;for(s=this.selectors,r=0,i=s.length;i>r;r++)if(o=s[r],1===o.parts.length&&this.isMatched(t,o)){a=o.events;for(n in a)e=a[n],t.on(n,e)}t.on("attached",this.bound("onAttached")),t.on("detached",this.bound("onDetached"))},e.prototype.onUnregister=function(t){var e,o,n,r,i,s,a;for(s=this.selectors,r=0,i=s.length;i>r;r++)if(o=s[r],1===o.parts.length&&this.isMatched(t,o)){a=o.events;for(n in a)e=a[n],t.un(n,e)}t.un("attached",this.bound("onAttached")),t.un("detached",this.bound("onDetached"))},e.prototype.onAttached=function(t){var e,o,n,r,i,s,a,c,u,p,l;for(u=this.selectors,i=0,a=u.length;a>i;i++)if(n=u[i],n.parts.length>1&&this.isMatched(t,n)){p=n.events;for(r in p)o=p[r],t.on(r,o)}if(t.isContainer)for(l=t.getComponents().toArray(),s=0,c=l.length;c>s;s++)e=l[s],this.onAttached(e)},e.prototype.onDetached=function(t){var e,o,n,r,i,s,a,c,u,p,l;for(u=this.selectors,i=0,a=u.length;a>i;i++)if(n=u[i],n.parts.length>1&&this.isMatched(t,n)){p=n.events;for(r in p)o=p[r],t.un(r,o)}if(t.isContainer)for(l=t.getComponents().toArray(),s=0,c=l.length;c>s;s++)e=l[s],this.onDetached(e)},e.prototype.isMatched=function(t,e){var o,n,r,i,s;if(i=Type.isString(e)?e.split(" "):e.parts,!t.is(i[i.length-1]))return!1;if(1===i.length)return!0;for(t=t.getParent(),n=i.length-1,o=s=i.length-1;s>=0;o=s+=-1)if(r=i[o],o!==n){for(;t&&!t.is(r);)t=t.getParent();if(null===t)return!1}return!0},e.prototype.doDestroy=function(){miwo.componentMgr.un("register",this.bound("onRegister")),miwo.componentMgr.un("unregister",this.bound("onUnregister"))},e}(Miwo.Object),e.exports=o},{}],7:[function(t,e){var o;o=function(){function t(){this.renderer=function(t,e){console&&console.log("FLASH:",t,e)}}return t.prototype.renderer=null,t.prototype.error=function(t){this.message(t,"error")},t.prototype.info=function(t){this.message(t,"info")},t.prototype.warning=function(t){this.message(t,"warning")},t.prototype.message=function(t,e){this.renderer&&this.renderer(t,e)},t}(),e.exports=o},{}],8:[function(t,e){var o;o=function(){function t(t,e,o){this.controller=t,this.action=e,null==o&&(o={}),this.params=Object.merge({},o)}return t.prototype.isRequest=!0,t.prototype.controller=null,t.prototype.action=null,t.prototype.view=null,t.prototype.params=null,t}(),e.exports=o},{}],9:[function(t,e){var o,n;o=t("./Request"),n=function(){function t(){}return t.prototype.codeRe=/^(([a-zA-Z]+)\:)?([a-z][a-zA-Z]+)?$/,t.prototype.create=function(t,e,n){var r,i,s;if(s=t.match(this.codeRe),!s)throw new Error("Bad redirect CODE");return i=void 0!==s[2]?s[2]:n.name,r="this"!==s[3]?s[3]:n.action,new o(i,r,e)},t}(),e.exports=n},{"./Request":8}],10:[function(t,e){var o,n;o=t("./Request"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.controller="default",e.prototype.action="default",e.prototype.constructRequest=function(t){var e,n,r,i;return r=t.match(/^(([a-zA-Z]*)(\:([a-z][a-zA-Z]+))?(\?(.*))?)?$/),n=r[2]||this.controller,e=r[4]||this.action,i=r[6]?this.parseQuery(r[6]):{},new o(n,e,i)},e.prototype.constructHash=function(t){var e,o;return e=t.controller,(t.action&&t.action!==this.action||t.params&&Object.getLength(t.params)>0)&&(e+=":"+t.action,t.params&&(o=Object.toQueryString(t.params),o&&(e+="?"+o))),e},e.prototype.parseQuery=function(t){var e,o,n,r,i,s;for(n={},s=t.split("&"),r=0,i=s.length;i>r;r++)e=s[r],o=e.split("="),n[decodeURIComponent(o[0])]=decodeURIComponent(o[1]);return n},e}(Miwo.Object),e.exports=n},{"./Request":8}],11:[function(t,e){var o,n;o=t("./ContentContainer"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.id="viewport",e.prototype.name="viewport",e.prototype.layout="absolute",e.prototype.componentCls="miwo-viewport",e.prototype.contentEl="div",e.prototype.view=null,e.prototype.animation=!1,e.prototype.animationFxIn="fadeIn",e.prototype.animationFxOut="fadeOut",e.prototype.animationDuration=1e3,e.prototype.afterInit=function(){if(e.__super__.afterInit.apply(this,arguments),this.content=this.get("content",!1),!this.content)throw new Error("Content component missing");if(!(this.content instanceof o))throw new Error("Content component should by instance of ContentContainer")},e.prototype.addContent=function(t){return this.add("content",new o(t))},e.prototype.hasView=function(t){return!!this.content.get(this.formatName(t),!1)},e.prototype.getView=function(t){return this.content.get(this.formatName(t))},e.prototype.addView=function(t,e){return this.content.add(this.formatName(t),e)},e.prototype.activateView=function(t,e){return this.view?void this.hideView(function(o){return function(){o.view.setActive(!1),o.view=o.getView(t),o.showView(function(){o.view.setActive(!0),e(o.view)})}}(this)):(this.view=this.getView(t),this.view.setActive(!0),this.view.show(),void e())},e.prototype.hideView=function(t){this.view||t(),this.animation?(this.view.el.addClass("animated").addClass(this.animationFxOut),setTimeout(function(e){return function(){e.view.hide(),e.view.el.removeClass("animated").removeClass(e.animationFxOut),t()}}(this),this.animationDuration)):(this.view.hide(),t())},e.prototype.showView=function(t){this.animation?(this.view.el.addClass("animated").addClass(this.animationFxIn),this.view.show(),t(),setTimeout(function(t){return function(){t.view.el.removeClass("animated").removeClass(t.animationFxIn)}}(this),this.animationDuration)):(this.view.show(),t())},e.prototype.formatName=function(t){var e,o,n;return n=t.split("."),e=n[0],o=n[1],e+o.capitalize()},e}(Miwo.Container),e.exports=n},{"./ContentContainer":2}],12:[function(t){Miwo.app={Application:t("./Application"),Controller:t("./Controller"),Router:t("./Router"),Request:t("./Request"),RequestFactory:t("./RequestFactory"),FlashNotificator:t("./FlashNotificator"),EventManager:t("./EventManager"),Viewport:t("./Viewport"),ContentContainer:t("./ContentContainer")},miwo.registerExtension("miwo-app",t("./DiExtension"))},{"./Application":1,"./ContentContainer":2,"./Controller":3,"./DiExtension":5,"./EventManager":6,"./FlashNotificator":7,"./Request":8,"./RequestFactory":9,"./Router":10,"./Viewport":11}]},{},[12])}();